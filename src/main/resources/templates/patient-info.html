<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Patient Information - Dashboard</title>
    <!-- Favicon -->
    <link href="/img/brand/favicon.png" rel="icon" type="image/png">
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" rel="stylesheet">
    <!-- Icons -->
    <link href="/js/plugins/nucleo/css/nucleo.css" rel="stylesheet" />
    <link href="/js/plugins/@fortawesome/fontawesome-free/css/all.min.css" rel="stylesheet" />
    <!-- CSS Files -->
    <link href="/css/argon-dashboard.css?v=1.1.2" rel="stylesheet" />

</head>


<body class="">
<nav class="navbar navbar-vertical fixed-left navbar-expand-md navbar-light bg-white" id="sidenav-main">
    <div class="container-fluid">
        <!-- Toggler -->
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#sidenav-collapse-main" aria-controls="sidenav-main" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <!-- Brand -->
        <a class="navbar-brand pt-0" href="../index.html">
            <img src="/img/brand/blue.png" class="navbar-brand-img" alt="...">
        </a>
        <!-- Collapse -->
        <div class="collapse navbar-collapse" id="sidenav-collapse-main">
            <!-- Navigation -->
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" href="../index.html">
                        <i class="ni ni-tv-2 text-primary"></i> Dashboard
                    </a>


                <li class="nav-item active">
                    <a class="nav-link active" href="./patient-info.html">
                        <i class="ni ni-single-02 text-yellow"></i> Patient Info
                    </a>

                <li class="nav-item">
                    <a class="nav-link" href="../examples/login.html">
                        <i class="ni ni-key-25 text-info"></i> Login
                    </a>

            </ul>
            <!-- Divider -->
            <hr class="my-3" />
            <!-- Heading -->
            <h6 class="navbar-heading text-muted">Documentation</h6>
            <!-- Documentation Links -->
            <ul class="navbar-nav mb-md-3">
                <li class="nav-item">
                    <a class="nav-link" href="https://demos.creative-tim.com/argon-dashboard/docs/getting-started/overview.html">
                        <i class="ni ni-spaceship"></i> Getting started
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="https://demos.creative-tim.com/argon-dashboard/docs/foundation/colors.html">
                        <i class="ni ni-palette"></i> Foundation
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="https://demos.creative-tim.com/argon-dashboard/docs/components/alerts.html">
                        <i class="ni ni-ui-04"></i> Components
                    </a>
                </li>
            </ul>
            <ul class="navbar-nav">

            </ul>
        </div>
    </div>
</nav>

<div class="main-content">
    <!-- Navbar -->
    <nav class="navbar navbar-top navbar-expand-md navbar-dark" id="navbar-main">
        <div class="container-fluid">
            <!-- Brand -->
            <a class="h4 mb-0 text-white text-uppercase d-none d-lg-inline-block" href="./patient-info.html">Patient Information</a>
            <!-- Form -->
            <form class="navbar-search navbar-search-dark form-inline mr-3 d-none d-md-flex ml-lg-auto">
                <div class="form-group mb-0">
                    <div class="input-group input-group-alternative">
                        <div class="input-group-prepend">
                            <span class="input-group-text"><i class="fas fa-search"></i></span>
                        </div>
                        <input class="form-control" placeholder="Search" type="text">
                    </div>
                </div>
            </form>
            <!-- User -->
            <ul class="navbar-nav align-items-center d-none d-md-flex">
                <li class="nav-item dropdown">
                    <a class="nav-link pr-0" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <div class="media align-items-center">
                <span class="avatar avatar-sm rounded-circle">
                  <img alt="Image placeholder" src="/img/theme/team-4-800x800.jpg">
                </span>
                            <div class="media-body ml-2 d-none d-lg-block">
                                <span class="mb-0 text-sm  font-weight-bold"></span>
                            </div>
                        </div>
                    </a>
                    <div class="dropdown-menu dropdown-menu-arrow dropdown-menu-right">
                        <div class="dropdown-header noti-title">
                            <h6 class="text-overflow m-0">Welcome!</h6>
                        </div>
                        <a href="../examples/profile.html" class="dropdown-item">
                            <i class="ni ni-single-02"></i>
                            <span>My profile</span>
                        </a>
                        <a href="../examples/profile.html" class="dropdown-item">
                            <i class="ni ni-settings-gear-65"></i>
                            <span>Settings</span>
                        </a>
                        <a href="../examples/profile.html" class="dropdown-item">
                            <i class="ni ni-calendar-grid-58"></i> Activity
                        </a>
                        <a href="../examples/profile.html" class="dropdown-item">
                            <i class="ni ni-support-16"></i> Support
                        </a>
                        <div class="dropdown-divider"></div>
                        <a href="#!" class="dropdown-item">
                            <i class="ni ni-user-run"></i> Logout
                        </a>
                    </div>
                </li>
            </ul>
        </div>
    </nav>

    <!-- Header -->
    <div class="header pb-8 pt-5 pt-lg-8 d-flex align-items-center">
        <span class="mask bg-gradient-default opacity-8"></span>
        <div class="container-fluid d-flex align-items-center">
            <h1 class="text-white">Patient Information Management</h1>
        </div>
    </div>

    <!-- Page content -->
    <div class="container mt-5">
        <h2 class="mb-4">Manage Patient Information</h2>
        <!-- Table for Patient Records -->
        <table class="table">
            <thead>
            <tr>
                <th>Patient ID</th>
                <th>Medical Record No</th> <!-- NEWLY ADDED FIELD -->
                <th>First Name</th>
                <th>Middle Name</th>
                <th>Last Name</th>
                <th>User Name</th> <!-- NEWLY ADDED FIELD -->
                <th>Password</th>
                <th>DOB</th>
                <th>Gender</th> <!-- NEWLY ADDED FIELD -->
                <th>Actions</th>
            </tr>
            </thead>
            <tbody id="patient-table-body">
            <!-- Rows will be dynamically added here -->
            </tbody>
        </table>
        <button class="btn btn-primary" onclick="openAddPatientModal()">Add New Patient</button>
    </div>

    <div class="modal fade" id="patientModal" tabindex="-1" role="dialog" aria-labelledby="patientModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="patientModalLabel">Add Patient</h5>
                </div>
                <div class="modal-body">
                    <form id="patient-form">
                        <div class="form-group">
                            <label for="patient_id">Patient ID</label>
                            <input type="number" class="form-control" id="patient_id" name="patient_id" disabled>
                        </div>
                        <div class="form-group">
                            <label for="medical_record_no">Medical Record No</label>
                            <input type="text" class="form-control" id="medical_record_no" name="medical_record_no" maxlength="6" required>
                        </div>
                        <div class="form-group">
                            <label for="first_name">First Name</label>
                            <input type="text" class="form-control" id="first_name" name="first_name" maxlength="50" required>
                        </div>
                        <div class="form-group">
                            <label for="middle_name">Middle Name</label>
                            <input type="text" class="form-control" id="middle_name" name="middle_name" maxlength="50">
                        </div>
                        <div class="form-group">
                            <label for="last_name">Last Name</label>
                            <input type="text" class="form-control" id="last_name" name="last_name" maxlength="50" required>
                        </div>
                        <div class="form-group">
                            <label for="user_name">User Name</label>
                            <input type="text" class="form-control" id="user_name" name="user_name" maxlength="1000" required>
                        </div>
                        <div class="form-group">
                            <label for="password">Password</label>
                            <input type="text" class="form-control" id="password" name="password" maxlength="1000" required>

                        </div>
                        <div class="form-group">
                            <label for="dob">Date of Birth</label>
                            <input type="date" class="form-control" id="dob" name="dob" required>
                        </div>
                        <div class="form-group">
                            <label for="gender">Gender</label>
                            <select class="form-control" id="gender" name="gender" required>
                                <option value="Male">Male</option>
                                <option value="Female">Female</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>

                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">Close</button>
                    <button type="button" class="btn btn-primary" id="save-patient-btn">Save</button>
                </div>


            </div>
        </div>
    </div>


    <!-- Footer -->
    <footer class="footer">
        <div class="row align-items-center justify-content-xl-between">
            <div class="col-xl-6">
                <div class="copyright text-center text-xl-left text-muted">
                    &copy; 2024 <a href="#" class="font-weight-bold ml-1" target="_blank">Your Name</a>
                </div>
            </div>
        </div>
    </footer>
</div>

<!-- Core JS -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="/js/plugins/jquery/scrollbar/jquery.scrollbar.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="/js/custom/patient-info.js"></script>

<script>
    window.TrackJS &&
    TrackJS.install({
        token: "ee6fab19c5a04ac1a32a645abde4613a",
        application: "argon-dashboard-free"
    });
</script>

<!-- Custom JS -->

    <script>
        document.addEventListener('DOMContentLoaded', () => {
        fetchPatientRecords();
    });

        // Fetch existing patients and display them
        function fetchPatientRecords() {
            fetch('/api/patient-info')
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`Error fetching patients: ${response.statusText}`);
                    }
                    return response.json();
                })
                .then(data => {
                    const tableBody = document.getElementById('patient-table-body');
                    tableBody.innerHTML = ''; // Clear table
                    data.forEach(patient => {
                        const row = `
                <tr>
                    <td>${patient.patientId || ''}</td> <!-- Patient ID -->
                    <td>${patient.medicalRecordNo || ''}</td> <!-- Medical Record No -->
                    <td>${patient.firstName || ''}</td> <!-- First Name -->
                    <td>${patient.middleName || ''}</td> <!-- Middle Name -->
                    <td>${patient.lastName || ''}</td> <!-- Last Name -->
                    <td>${patient.userId || ''}</td> <!-- User Name -->
                    <td>${patient.password || ''}</td> <!-- Masked Password -->
                    <td>${patient.dob || ''}</td> <!-- DOB -->
                    <td>${patient.gender || ''}</td> <!-- Gender -->

                    <td>
                        <button class="btn btn-sm btn-warning" onclick="editPatient(${patient.patientId})">Edit</button>

                    </td>
                </tr>`;
                        tableBody.innerHTML += row;
                    });
                })
                .catch(err => {
                    console.error('Error fetching patient records:', err);
                    alert('Failed to fetch patient records.');
                });
        }




        // Open the modal to add a new patient
        function openAddPatientModal() {
        document.getElementById('patient-form').reset();
        document.getElementById('patientModalLabel').innerText = 'Add Patient';
        document.getElementById('save-patient-btn').onclick = savePatient;
        $('#patientModal').modal('show');
    }

        // Add a new patient
        function savePatient() {
        const patient = {
            medicalRecordNo: document.getElementById("medical_record_no").value,
            firstName: document.getElementById("first_name").value,
            middleName: document.getElementById("middle_name").value,
            lastName: document.getElementById("last_name").value,
            userId: document.getElementById("user_name").value,
            password: document.getElementById("password").value,
            dob: document.getElementById("dob").value, // Collect Date of Birth
            gender: document.getElementById("gender").value // Collect Gender
    };

        fetch('/api/patient-info', {
        method: 'POST',
        headers: {
        'Content-Type': 'application/json',
    },
        body: JSON.stringify(patient),
    })
        .then(response => {
        if (!response.ok) {
        throw new Error(`Error adding patient: ${response.statusText}`);
    }
        return response.json();
    })
        .then(() => {
        $('#patientModal').modal('hide');
        fetchPatientRecords();
        alert('Patient added successfully!');
    })
        .catch(err => {
        console.error(err);
        alert('Failed to add patient.');
    });
    }

        function editPatient(patientId) {
            fetch(`/api/patient-info/${patientId}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`Error fetching patient with ID ${patientId}: ${response.statusText}`);
                    }
                    return response.json();
                })
                .then(patient => {
                    document.getElementById("patient_id").value = patient.patientId;
                    document.getElementById("medical_record_no").value = patient.medicalRecordNo;
                    document.getElementById("first_name").value = patient.firstName;
                    document.getElementById("middle_name").value = patient.middleName || "";
                    document.getElementById("last_name").value = patient.lastName;
                    document.getElementById("user_name").value = patient.userId;
                    document.getElementById("password").value = patient.password;
                    document.getElementById("dob").value = patient.dob;
                    document.getElementById("gender").value = patient.gender;

                    // Set modal title and save function for editing
                    document.getElementById("patientModalLabel").innerText = "Edit Patient";
                    document.getElementById("save-patient-btn").onclick = function () {
                        updatePatient(patientId);
                    };

                    $("#patientModal").modal("show");
                })
                .catch(err => {
                    console.error("Error editing patient:", err);
                    alert("Failed to fetch patient details for editing.");
                });
            function updatePatient(patientId) {
                const patient = {
                    medicalRecordNo: document.getElementById("medical_record_no").value,
                    firstName: document.getElementById("first_name").value,
                    middleName: document.getElementById("middle_name").value,
                    lastName: document.getElementById("last_name").value,
                    userId: document.getElementById("user_name").value,
                    password: document.getElementById("password").value,
                    dob: document.getElementById("dob").value, // Collect Date of Birth
                    gender: document.getElementById("gender").value // Collect Gender
                };

                fetch(`/api/patient-info/${patientId}`, {
                    method: 'PUT', // Use PUT for updating
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(patient), // Send the updated patient object
                })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`Error updating patient: ${response.statusText}`);
                        }
                        return response.json();
                    })
                    .then(() => {
                        $('#patientModal').modal('hide');
                        fetchPatientRecords(); // Refresh the patient list
                        alert('Patient updated successfully!');
                    })
                    .catch(err => {
                        console.error('Error updating patient:', err);
                        alert('Failed to update patient.');
                    });
            }

        }

        function closeModal() {
            $('#patientModal').modal('hide');
        }



    </script>

</body>

</html>
