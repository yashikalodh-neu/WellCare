<!DOCTYPE html>
<html lang="en">

<head>
    <script src="/js/common.js"></script>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>My Profile</title>
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" rel="stylesheet">
    <!-- Icons -->
    <link href="/js/plugins/nucleo/css/nucleo.css" rel="stylesheet" />
    <link href="/js/plugins/@fortawesome/fontawesome-free/css/all.min.css" rel="stylesheet" />
    <!-- CSS Files -->
    <link href="/css/argon-dashboard.css?v=1.1.2" rel="stylesheet" />
</head>

<body class="">
<!-- Sidebar -->
<nav class="navbar navbar-vertical fixed-left navbar-expand-md navbar-light bg-white" id="sidenav-main">
    <div class="container-fluid">
        <!-- Toggler -->
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#sidenav-collapse-main" aria-controls="sidenav-main" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <!-- Navigation -->
        <div class="collapse navbar-collapse" id="sidenav-collapse-main">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" href="http://localhost:8080/staff-dashboard">
                        <i class="ni ni-tv-2 text-primary"></i> Dashboard
                    </a>
                </li>
                <li class="nav-item active">
                    <a class="nav-link" href="http://localhost:8080/staffprofiletesting">
                        <i class="ni ni-single-02 text-yellow"></i> My Profile
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="http://localhost:8080/staffappointment">
                        <i class="ni ni-bullet-list-67 text-red"></i> Appointments
                    </a>
                </li>
            </ul>
        </div>
    </div>
</nav>

<div class="main-content">
    <!-- Navbar -->
    <nav class="navbar navbar-top navbar-expand-md navbar-dark" id="navbar-main">
        <div class="container-fluid">
            <a class="h1 mb-0 text-white text-uppercase d-none d-lg-block text-center w-100" style="font-size: 2.5rem;">
                Staff Dashboard
            </a>
        </div>
    </nav>

    <!-- Header -->
    <div class="header bg-gradient-primary pb-8 pt-5 pt-md-8">
        <div class="container-fluid">
            <div class="header-body"></div>
        </div>
    </div>

    <!-- Page Content -->
    <div class="container mt-5">
        <h2 class="mb-4">Personal Information</h2>
        <!-- Profile Information -->
        <div class="card shadow">
            <div class="card-body">
                <p><strong>Staff ID:</strong> <span id="staff-id">N/A</span></p>
                <p><strong>First Name:</strong> <span id="first-name">N/A</span></p>
                <p><strong>Middle Name:</strong> <span id="middle-name">N/A</span></p>
                <p><strong>Last Name:</strong> <span id="last-name">N/A</span></p>
                <p><strong>Role:</strong> <span id="role">N/A</span></p>
                <p><strong>Department:</strong> <span id="department">N/A</span></p>
                <p><strong>Email:</strong> <span id="email">N/A</span></p>
                <p><strong>Phone Number:</strong> <span id="phone-number">N/A</span></p>
                <p><strong>Specialization:</strong> <span id="specialization">N/A</span></p>
                <button class="btn btn-primary" onclick="openEditModal()">Edit Profile</button>
            </div>
        </div>
    </div>

    <!-- Edit Modal -->
    <div class="modal fade" id="editModal" tabindex="-1" role="dialog" aria-labelledby="editModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editModalLabel">Edit Profile</h5>
                </div>
                <div class="modal-body">
                    <form id="edit-form">
                        <div class="form-group">
                            <label for="edit-first-name">First Name</label>
                            <input type="text" class="form-control" id="edit-first-name" required>
                        </div>
                        <div class="form-group">
                            <label for="edit-middle-name">Middle Name</label>
                            <input type="text" class="form-control" id="edit-middle-name">
                        </div>
                        <div class="form-group">
                            <label for="edit-last-name">Last Name</label>
                            <input type="text" class="form-control" id="edit-last-name" required>
                        </div>
                        <div class="form-group">
                            <label for="edit-role">Role</label>
                            <input type="text" class="form-control" id="edit-role" required>
                        </div>
                        <div class="form-group">
                            <label for="edit-department">Department</label>
                            <input type="text" class="form-control" id="edit-department">
                        </div>
                        <div class="form-group">
                            <label for="edit-email">Email</label>
                            <input type="email" class="form-control" id="edit-email" required>
                        </div>
                        <div class="form-group">
                            <label for="edit-phone-number">Phone Number</label>
                            <input type="text" class="form-control" id="edit-phone-number">
                        </div>
                        <div class="form-group">
                            <label for="edit-specialization">Specialization</label>
                            <input type="text" class="form-control" id="edit-specialization">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="saveProfile()">Save Changes</button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Footer -->
<footer class="footer">
    <div class="row align-items-center justify-content-xl-between">
        <div class="col-xl-6">
            <div class="copyright text-center text-xl-left text-muted">
                &copy; 2024 Your Organization
            </div>
        </div>
        <div class="col-xl-6">
            <ul class="nav nav-footer justify-content-center justify-content-xl-end">
                <li class="nav-item">
                    <a href="#" class="nav-link" target="_blank">About Us</a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" target="_blank">Contact</a>
                </li>
            </ul>
        </div>
    </div>
</footer>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', fetchMyProfile);

    function fetchMyProfile() {
        const staffId = getCookie('id');
        const token = getCookie('token');

        if (!staffId || !token) {
            alert('Unauthorized access!');
            return;
        }

        fetch(`/api/vi/staff/get/${staffId}`, {
            headers: {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json'
            }
        })
            .then(response => response.json())
            .then(data => {
                document.getElementById('staff-id').innerText = data.staffId || 'N/A';
                document.getElementById('first-name').innerText = data.firstName || 'N/A';
                document.getElementById('middle-name').innerText = data.middleName || 'N/A';
                document.getElementById('last-name').innerText = data.lastName || 'N/A';
                document.getElementById('role').innerText = data.role || 'N/A';
                document.getElementById('department').innerText = data.department || 'N/A';
                document.getElementById('email').innerText = data.email || 'N/A';
                document.getElementById('phone-number').innerText = data.phoneNumber || 'N/A';
                document.getElementById('specialization').innerText = data.specialization || 'N/A';
            })
            .catch(err => {
                console.error('Error fetching profile:', err);
                alert('Failed to load profile.');
            });
    }

    function openEditModal() {
        document.getElementById('edit-first-name').value = document.getElementById('first-name').innerText;
        document.getElementById('edit-middle-name').value = document.getElementById('middle-name').innerText;
        document.getElementById('edit-last-name').value = document.getElementById('last-name').innerText;
        document.getElementById('edit-role').value = document.getElementById('role').innerText;
        document.getElementById('edit-department').value = document.getElementById('department').innerText;
        document.getElementById('edit-email').value = document.getElementById('email').innerText;
        document.getElementById('edit-phone-number').value = document.getElementById('phone-number').innerText;
        document.getElementById('edit-specialization').value = document.getElementById('specialization').innerText;

        const editModal = new bootstrap.Modal(document.getElementById('editModal'));
        editModal.show();
    }

    function saveProfile() {
        const staffId = getCookie('id');
        const token = getCookie('token');

        const updatedProfile = {
            firstName: document.getElementById('edit-first-name').value,
            middleName: document.getElementById('edit-middle-name').value,
            lastName: document.getElementById('edit-last-name').value,
            role: document.getElementById('edit-role').value,
            department: document.getElementById('edit-department').value,
            email: document.getElementById('edit-email').value,
            phoneNumber: document.getElementById('edit-phone-number').value,
            specialization: document.getElementById('edit-specialization').value
        };

        fetch(`/api/vi/staff/update/${staffId}`, {
            method: 'PUT',
            headers: {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(updatedProfile)
        })
            .then(() => {
                fetchMyProfile();
                alert('Profile updated successfully!');
            })
            .catch(err => {
                console.error('Error updating profile:', err);
                alert('Failed to update profile.');
            });
    }

    function getCookie(name) {
        const value = `; ${document.cookie}`;
        const parts = value.split(`; ${name}=`);
        if (parts.length === 2) return parts.pop().split(';').shift();
    }
</script>

</body>
</html>
